let start=0;const limit=10;let loading=!1,noMoreData=!1,searchQuery="";const fetchVideos=async()=>{if(!loading&&!noMoreData){loading=!0,document.getElementById("loader").style.display="block";try{const t=await fetch(`api/history/video_history.php?start=${start}&limit=10&query=${encodeURIComponent(searchQuery)}`),e=await t.json();e.length>0?(renderVideos(e),start+=10):(noMoreData=!0,document.getElementById("no-more-data").style.display="block")}catch(t){console.error("Error fetching videos:",t)}finally{document.getElementById("loader").style.display="none",loading=!1}}},renderVideos=t=>{const e=document.getElementById("video-container");0===start&&(e.innerHTML="");const a=t.reduce(((t,e)=>(t[e.datestatus]||(t[e.datestatus]=[]),t[e.datestatus].push(e),t)),{});Object.keys(a).forEach((t=>{const n=document.createElement("h1");n.className="date-status card-list-title my-3",n.textContent=t,n.setAttribute("data-datestatus",t),e.appendChild(n),a[t].forEach((a=>{const n=document.createElement("div");n.className="video-item",n.setAttribute("id",`video-${a.historyid}`),n.setAttribute("data-datestatus",t),n.innerHTML=`<div class="card-list"><a href="${a.id}"><div class="card-list-media md:w-40 md:h-full w-full h-40"><img src="${a.filePath}" alt="${a.title}"></div></a><div class="md:flex gap-10 md:items-end flex-1"><div class="card-list-body"><a href="${a.id}"><h3 class="card-list-title text-base line-clamp-1">${a.title}</h3></a><p class="mt-0.5 text-black dark:text-white">${a.uploadedBy}</p><div class="card-list-info text-xs"><div>${a.views} views</div></div></div><div class="flex items-center gap-2 self-end pt-2 sm:justify-end"><button type="button" id="remove-${a.historyid}" class="button bg-secondery max-sm:flex-1 remove-button" data-id="${a.historyid}" data-datestatus="${t}">Remove</button><button type="button" class="button bg-secondery px-2.5 py-2"><ion-icon name="arrow-redo" class="text-base"></ion-icon></button></div></div></div><hr class="card-list-divider">`,e.appendChild(n)}))})),attachRemoveListeners()},attachRemoveListeners=()=>{document.querySelectorAll(".remove-button").forEach((t=>{t.addEventListener("click",(async t=>{const e=t.target.dataset.id,a=t.target.dataset.datestatus;await removeVideo(e,a)}))}))},removeVideo=async(t,e)=>{try{const a=await fetch("api/history/delete_history.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({historyId:t})}),n=await a.json();if(n.success){const a=document.getElementById(`video-${t}`);a&&a.remove();if(0===document.querySelectorAll(`.video-item[data-datestatus="${e}"]`).length){const t=document.querySelector(`.date-status[data-datestatus="${e}"]`);t&&t.remove()}}else console.error("Failed to remove video:",n.message)}catch(t){console.error("Error removing video:",t)}};document.getElementById("search-input").addEventListener("input",(t=>{searchQuery=t.target.value.trim(),start=0,noMoreData=!1,fetchVideos()}));const handleScroll=()=>{window.innerHeight+window.scrollY>=document.body.offsetHeight-100&&!loading&&!noMoreData&&fetchVideos()};document.addEventListener("DOMContentLoaded",fetchVideos),window.addEventListener("scroll",handleScroll)
