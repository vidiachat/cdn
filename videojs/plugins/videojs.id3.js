/**
 * Copyright (c) 2024 The Nuevodevel Team. All rights reserved.
 * Audio ID3 plugin for video.js
 * Version 1.0.0
 */
!function(e,t){"function"==typeof define&&define.amd?define([],t.bind(this,e,e.videojs)):"undefined"!=typeof module&&module.exports?module.exports=t(e,e.videojs):t(e,e.videojs)}(window,function(n,x){"use strict";let r=!(n.videojs_id3={version:"1.00.0"});var e=document.createElement("script");e.src="https://cdnjs.cloudflare.com/ajax/libs/jsmediatags/3.9.5/jsmediatags.min.js",document.body.appendChild(e),e.addEventListener("load",()=>{r=!0});x.registerPlugin("id3",function(y){var g=this,t={lyrics:!0,lyricsColor:"white",lyricsBackground:"rgba(0,0,0,.8)",lyricsFontSize:100,lyricsDuration:5,lyricsShadow:!1,lyricsMinFontSize:20};try{y=x.obj.merge(t,y||{})}catch(e){y=x.mergeOptions(t,y||{})}let f=[],h=[],v=null,b=null,j;g.one("playing",function(){g.id3=!1}),g.on("loadstart",function(){var e=g.el_.querySelector(".vjs-lyrics-display");e&&e.parentNode.removeChild(e);e=g.currentType().indexOf("audio");h.length=0;let t=f.length=0;(g.isAudio()||-1<e)&&(r?i(g.currentSrc()):setTimeout(function e(){r?i(g.currentSrc()):++t<10&&setTimeout(e,10)},10))});const i=async function(e){var t,i=n.jsmediatags;try{var r=await fetch(e);200===r.status&&(t=await r.blob(),i.read(t,{onSuccess:e=>{var e=e.tags,i={},t=g.el();if((r=t.querySelector(".vjs-audio-info"))&&t.removeChild(r),e.artist&&e.title){i.artist=e.artist,i.title=e.title;var r=t.querySelector(".vjs-info"),r=(r&&r.parentNode.removeChild(r),document.createElement("span")),n=(r.className="vjs-audio-info","");if(e.picture){var s=e.picture;if(s.format&&s.data){let t="";var o=s.data;for(let e=0;e<o.length;e++)t+=String.fromCharCode(o[e]);s="data:"+s.format+";base64,"+btoa(t);n+='<span class="vjs-cover"><img src="'+(i.cover=s)+'"></span>'}}if(g.off("timeupdate",p),e.lyrics&&y.lyrics&&e.lyrics.language&&e.lyrics.lyrics){var s=e.lyrics.lyrics,l=s.split("\n");if(f=s.split("\r\n"),1<(f=l.length>f.length?l:f).length){for(var a,c,d,u=0;u<f.length;u++)2<f[u].length&&(a=f[u].split("]"),c=a[0].replace("[",""),a[0]=function(e){let t=e.split(":").map(Number),i=null;3==t.length?i=3600*t[0]+60*t[1]+t[2]:2==t.length?i=60*t[0]+t[1]:1==t.length&&(i=t[0]);return i}(c),0<parseInt(a[0]))&&0<a[1].length&&h.push({start:a[0],end:a[0]+5,txt:a[1]});0<h.length&&(function(){var e=".vjs-lyrics-display{position: absolute;bottom:4em;left: 0;right:0;top:0;pointer-events:none;z-index:999}";e=(e+=".vjs-lyrics-div{position: absolute;inset: 0px;margin: 1.5%;}")+".vjs-lyrics-cue{direction:ltr;writing-mode:horizontal-tb;unicode-bidi:plaintext;text-align:center;font:22px sans-serif;white-space:pre-line;position:absolute;width:100%;background-color: rgba(0, 0, 0, 0);bottom:0;margin:0;}.vjs-lyrics-cue span{background:black;color:white}",(e=document.createElement("style")).innerHTML=".vjs-lyrics-display{position: absolute;bottom:4em;left: 0;right:0;top:0;pointer-events:none;z-index:999}.vjs-lyrics-div{position: absolute;inset: 0px;margin: 1.5%;}.vjs-lyrics-cue{direction:ltr;writing-mode:horizontal-tb;unicode-bidi:plaintext;text-align:center;font:22px sans-serif;white-space:pre-line;position:absolute;width:100%;background-color: rgba(0, 0, 0, 0);bottom:0;margin:0;}.vjs-lyrics-cue span{background:black;color:white}",g.el_.appendChild(e)}(),(b=document.createElement("div")).className="vjs-lyrics-display",(l=document.createElement("div")).className="vjs-lyrics-div",b.appendChild(l),(d=document.createElement("div")).className="vjs-lyrics-cue",v=document.createElement("span"),y.lyricsShadow&&(v.style.textShadow="rgb(34, 34, 34) 1px 1px, rgb(34, 34, 34) 2px 2px, rgb(34, 34, 34) 3px 3px"),"white"!==y.lyricsColor&&(v.style.color=y.lyricsColor),"rgba(0,0,0,.8)"!==y.lyricsBackground&&(v.style.backgroundColor=y.lyricsBackground),l.appendChild(d),d.appendChild(v),g.on("timeupdate",p),g.el_.appendChild(b))}}function p(){var e=g.currentTime();try{for(var n=h.length-1;0<=n;n--){if(e>=h[n].start&&e<h[n].end){clearTimeout(j);let e=g.el_.offsetHeight,t=g.el_.offsetWidth,i=.03;b.style.bottom="4em";var s=(i=x.browser.IS_IPHONE||x.browser.IS_ANDROID?.04:i)*y.lyricsFontSize/100;let r=Math.round(g.el_.offsetWidth*s*100)/100;t<e&&(b.style.bottom="5em",s=.045*y.lyricsFontSize/100,r=Math.round(g.el_.offsetHeight*s*100)/100),r<20&&(r=20),v.style.fontSize=r+"px",v.innerHTML="&nbsp;"+h[n].txt+"&nbsp;",j=setTimeout(m,1e3*y.lyricsDuration);break}v.innerHTML=""}}catch(e){console.log(e)}}function m(){v.innerHTML=""}g.on("playerresize",()=>{var n=g.el_.querySelector(".vjs-lyrics-cue");if(n){let e=g.el_.offsetHeight,t=g.el_.offsetWidth,i=.03;(x.browser.IS_IPHONE||x.browser.IS_ANDROID)&&(i=.04),b.style.bottom="4em";var s=i*y.lyricsFontSize/100;let r=Math.round(g.el_.offsetWidth*s*100)/100;t<e&&(b.style.bottom="5em",s=.045*y.lyricsFontSize/100,r=Math.round(g.el_.offsetHeight*s*100)/100),r<20&&(r=20),n.style.fontSize=r+"px"}}),n+='<span class="vjs-audio-item vjs-text">',e.artist&&(n+='<span class="audio-artist">'+e.artist+"</span>"),e.title&&(n+='<span class="vjs-audio-item vjs-song">'+e.title+"</span>"),(e.genre||e.album||e.year)&&(n+='<span class="vjs-audio-item audio-id">',e.album&&(i.album=e.album,n+="<span>Album: "+e.album+"</span>"),e.year||e.genre?e.year&&(i.year=e.year,n+="<span>Year: "+e.year,e.genre)&&(i.genre=e.genre,n+=" | Genre: "+e.genre):e.genre&&(i.genre=e.genre,n+="<span>Genre: "+e.genre),n+="</span>"),n+="</span>",g.ids=!0,g.setAudioInfo(i),r.innerHTML=n,t.appendChild(r)}},onError:e=>{console.log("id3 error")}}))}catch(e){console.log("id3 error")}}})});
