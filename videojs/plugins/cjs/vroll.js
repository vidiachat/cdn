/**
 * Copyright (c) 2024 The Nuevodevel Team. All rights reserved.
 * Vroll Ads plugin for video.js
 * Version 2.5.0
 */
/* eslint-disable *//* eslint-env node */function _interopDefault(e){return e&&"object"===typeof e&&"default"in e?e.default:e}var videojs=_interopDefault(require("video.js"));function vrollInit(N,e,t){var L,P=null,H=[],E=null,O=!1,$=!1,z=!0,B=!1,V=!1,Z=!1,F=!1,Q=!1,R="undefined",U=-1,D=0,G=N.$(".vjs-tech"),J=(videojs.isAd=!1,videojs.dom),K=N.el(),s=videojs.browser,W=null,X=null,Y=[],ee=null,i=null,te=null,ie=null;videojs.vrollplugin=!0;if(t){t.trackUrl&&(P=t.trackUrl);i=t}function r(e){return"[object Array]"===Object.prototype.toString.call(e)}var re=function(e,t){e=document.createElement(e);"undefined"!==typeof t&&""!==t&&(e.className=t);return e},oe=function(e){return N.localize(e)};function ne(){return N.duration()===1/0||"8"===s.IOS_VERSION&&0===N.duration()}t=!0;if(!r(e)){var o=e;if(o.src&&o.src.length>5){o.offset?o.offset.indexOf("%")>-1&&ne()&&(t=!1):o.offset=0;t&&((e=[])[0]=o)}}if(r(e))for(var n=0;n<e.length;n++){var se=e[n];se.offset||(se.offset=0);if(se.src&&"undefined"!==se.offset){se.loaded=!1;0;H.push(se)}}function le(){return N.el_.className.indexOf("vjs-casting")>0}function ae(){return!!N.el_.classList.contains("vjs-ad-playing")}N.ready(function(){N.vroll.reset=function(){for(var e=0;e<H.length;e++)H[e].loaded=!1;H.length>0&&H.length<2&&(H=H[0]);N.vroll(H,i);N.play()};N.one("playing",function(){N.mediaStarted=!0});N.vroll.request=function(e){H=[];N.vroll(e);N.play()};te=N.el_.querySelector(".vjs-loading-spinner");var w=N.el_.querySelector(".vjs-big-play-button");X=N.el_.querySelector(".vjs-replay-button");if(H.length>0){(E=N.el_.querySelector(".vast-blocker"))&&N.el_.removeChild(E);E=re("a","vast-blocker vjs-hidden");N.el_.insertBefore(E,N.controlBar.el_.nextSibling);const M=function(e){if(ie)return ie;e.el().querySelector(".vjs-tech");const t=e.textTracks?e.textTracks():[],i=[],r={ended:e.ended(),src:e.currentSrc(),currentTime:e.currentTime(),duration:e.duration(),currentSource:e.currentSource(),type:e.currentType(),playing:!e.paused(),live:!1,suppressedTracks:[]};r.duration&&r.duration-r.currentTime<1&&(r.ended=!0);r.ended&&(r.currentTime=e.duration()+1);for(let e=0;e<t.length;e++){const o=t[e];i.push({track:o,mode:o.mode});o.mode="disabled"}r.suppressedTracks=i;if(e.seekable().length>0&&ne()){r.live=!0;r.currentTime=e.currentTime()-e.seekable().end(0)}return r};function I(e){e=e.textTracks?e.textTracks():[];if((e=r(e)?e:[]).length>0){var t=[];e.forEach(function(e){t.push({track:e,mode:e.mode});e.mode="disabled"})}return t}const q=function(o){o.snapshot=null;let n=ie;o.snapshot=ie;if(o.src()===n.src)o.play();else{var e=o.el().querySelector(".vjs-tech");if(!e.hasAttribute("outstream")){var i=20;"style"in ie&&e.setAttribute("style",n.style||"");o.src(n.currentSource);if(n.ended){o.currentTime(n.duration);o.trigger("ended")}else{o.one("playing",t);o.one("canplay",s);r()}}}function t(){var e=o.textTracks?o.textTracks():[];if(e.length>0)for(var t=0;t<e.length;t++){var i=e[t],r=n.suppressedTracks[t];i.mode=r.mode}}function r(){var e=setTimeout(function(){o.trigger("canplay")},1e3);o.one("canplay",function(){clearTimeout(e)})}function s(){var e=o.$(".vjs-tech");if(!l(o)&&i--)setTimeout(s,50);else{if(o.snapshot.live){o.seekable().length>0?o.currentTime(o.seekable().end(0)+o.snapshot.currentTime):o.currentTime(o.snapshot.currentTime);o.play()}else if(o.snapshot.ended)o.currentTime(o.snapshot.duration);else{o.currentTime(o.snapshot.currentTime);var t=o.play();t&&t.catch&&t.catch(function(e){videojs.log.warn("Play promise rejected in snapshot restore",e)})}e.setAttribute("style",ie.style||"")}}function l(e){return e.readyState()>1||void 0===e.seekable()||e.seekable().length>0}};for(var e=0;e<H.length;e++)H[e].offset||(H[0].offset=0);if(0===parseInt(H[0].offset,10))if(N.offline)N.isPreroll=!1;else{if((N.isPreroll=!0)!==Q){Q=!0;D=N.volume()}N.one("play",function(){if(N.isPreroll){var e=N.el_.querySelector(".vjs-poster");(W=re("div","vjs-black-poster"))||K.insertBefore(W,e);N.isPreroll=!1}})}t();function t(){if(N.isOffline)F=!1;else if(!F){F=!0;N.$(".vjs-tech").hasAttribute("outstream")&&!G.hasAttribute("outstreamvisit")&&N.el_.classList.add("vjs-set-replay");!0!==ne()&&N.duration();if(H.length>0&&!0!==Z){if(N.isPreroll&&G.hasAttribute("outstreamvisit")){var e=document.createElement("style"),t=".video-js .vjs-tech{opacity:1!important}";e.textContent=t=(t=(t=(t+=".vjs-visit-blocker{background:rgba(0, 0, 0, .77);bottom:auto;right:10px!important;left:auto!important;top:10px!important;display:table!important;width:auto!important;height:auto!important;color:#fff!important;padding:4px 6px!important;border-radius:8px;border:solid 2px rgba(255, 255, 255, .8)!important}")+".vjs-visit-blocker:hover{border:solid 2px rgba(255, 255, 255, 1)!important}"+".vjs-visit-block{position:absolute;transform:translate(-50%, -50%);-webkit-transform:translate(-50%, -50%);top:45%;left:50%;text-align:center;color:#fff}")+".btn-visit{cursor:pointer;font-size:16px;text-transform:uppercase;background:#383838;display:table;margin-bottom:10px;-webkit-border-radius:50%;border-radius:50%;width:60px;height:60px;line-height:60px;}"+".btn-visit:hover{background:#484848}")+".btn-visit-replay{cursor:pointer;display:table;padding:4px 6px;margin:0 auto;border:solid 1px #999}"+".video-js .vjs-bg-bar{height:0!important}";N.el_.insertBefore(e,G)}Z=!0;for(var i=0;i<H.length;i++){H[i].method="";if("100%"==H[i].offset||"end"===H[i].offset){H[i].method="postroll";H[i].offset="end";Y.push(H[i])}}}if(H.length>0){N.one("play",function(){0==H[0].offset&&!0!==H[0].loaded&&c(0)});N.on("timeupdate",r);function r(){if(!ae()){H[H.length-1].loaded&&N.off("timeupdate",r);var e=videojs.dom.hasClass(K,"vjs-has-started"),t=ne();e&&!0!==B&&!0!==N.isOffline&&(t&&0==H[0].offset&&!0!==H[0].loaded?c(0):c(N.currentTime()))}}function o(){J.addClass(X,"vjs-hidden")}function n(e){if(N.$(".vjs-tech").hasAttribute("outstreamvisit"))v();else if(B)h();else if(O){N.trigger("vroll",{id:R.id,action:"completed"});k("completed");h()}else{if(null!==Y){ie=ie||M(N);te.setAttribute("style","display:none !important");for(var t=0;t<Y.length;t++)if(!0!==Y[t].loaded){N.trigger("vroll",{id:R.id,action:"completed"});k("completed");ie=ie||M(N);l();return}}N.trigger("vroll",{id:R.id,action:"completed"});k("completed");a(!0);N.off("ended",n);h();s()}}function s(){if(N.playlist&&N.playlist.length>0){N.pause();N.playlist.next(!0)}}N.on("ended",n);N.one("play",o);function l(){for(var e=0;e<Y.length;e++)if(!0!==Y[e].loaded){Y[e].loaded=!0;d(Y[e]);return}a();q(N)}function a(e){N.off("timeupdate",_);N.off("error",S);E.className="vast-blocker vjs-hidden";B=V=O=!1;x(".vast-skip-button");setTimeout(function(){te.removeAttribute("style")},200);J.addClass(K,"vjs-has-started");G.poster="";J.removeClass(K,"vjs-ad-playing");videojs.isAd=!1}function d(e){e.loaded=!0;R=e;B=!0;videojs.isAd=!0;J.addClass(K,"vjs-ad-playing");V=!0;N.on("error",S);e={src:e.src,type:e.type};N.src(e);te.setAttribute("style","display:none !important");setTimeout(function(){N.play()},100);N.one("playing",function(){A()})}function f(e,t){O=B=!0;e.loaded=!0;N.adhref=null;if(!le()){z=!($=!(V=!0));var r={src:(R=e).src,type:e.type};let t=e.offset,i=[];for(let e=0;e<H.length;e++)t===H[e].offset&&i.push(H[e]);i.length>1&&e!==i[i.length-1]&&(z=!1);ie=ie||M(N);te.setAttribute("style","display:none !important");N.src(r);N.on("error",S);setTimeout(function(){N.play();N.one("playing",function(){A()})},10)}}if(N.isPreroll){if(!0!==Q){Q=!0;D=N.volume();N.volume(0)}ne()}function c(e){var t=e;if(!B)for(var i=0;i<H.length;i++){var r=H[i];r.offset||(r.offset=0);if("string"===typeof r.offset&&r.offset.indexOf("%")>0&&N.duration()){let e=parseInt(se.offset);H[i].offset=e/100*N.duration()}if(ne()&&H[i].offset>0)return;t>=H[i].offset&&!0!==O&&!0!==H[i].loaded&&(!0!==le()?f(r):H[i].loaded=!0)}}E.onclick=function(){N.trigger("vroll",{id:R.id,action:"clicked"});k("click")};N.on("chromecastConnected",function(){u()});function u(){if(N.isPreroll){H[0].cancelled=!0;x(".vast-skip-button");ee=null;U=-1;N.off("play",A);H[0].loaded=!0;N.isPreroll=!1;J.addClass(K,"vjs-has-started");J.removeClass(K,"vjs-ad-playing");N.off("timeupdate",_);N.off("error",S);q(N);ie=null}}function p(){return N.paused()}function v(){x(".vast-skip-button");ee=null;U=-1;var e=E.href,t=(N.isPreroll=!1,[]);t.push(H[0]);t[0].loaded=!1;H=t;let i=N.el_.querySelector(".btn-visit");if(!i){console.log("visit");var r=document.createElement("div"),t=(N.el().appendChild(r),document.createElement("div")),o=document.createElement("div"),n=document.createElement("div");r.className="vjs-overlay";t.class="vjs-block";t.className="vjs-visit-block";o.className="btn-visit";n.className="btn-visit-replay";r.appendChild(t);o.innerHTML="VISIT";n.innerHTML="Replay";t.appendChild(o);t.appendChild(n);o.onclick=function(){window.open(e,"_blank")};n.onclick=function(){N.currentTime(0);N.play();N.el().removeChild(r)}}}function h(){x(".vast-skip-button");ee=null;U=-1;if(N.$(".vjs-tech").hasAttribute("outstreamvisit")){v();N.trigger("ended")}else if(N.$(".vjs-tech").hasAttribute("outstream")){H=[];ee=null;U=-1;N.off("play",A);N.isPreroll=!1;N.off("error",S);N.off("timeupdate",_);N.off("ended",n);N.el_.classList.add("vjs-set-replay");N.pause();N.trigger("ended");N.currentTime(0);N.el_.classList.add("vjs-ad-playing");N.pause()}else{var t=R.offset,i=(R.loaded=!0,N.isPreroll=!1);J.addClass(K,"vjs-has-started");for(var r=0;r<H.length;r++){H[r].offset;H[r].offset||(H[r].offset=0);let e=H[r].offset;if("string"===typeof e&&e.indexOf("%")>0&&N.duration()){e=parseInt(H[r].offset)/100;H[r].offset=parseInt(e*N.duration())}if(ne()&&H[r].offset>0)return;H[r].offset||(H[r].offset=0);if(H[r].offset===t&&!0!==H[r].loaded){N.off("timeupdate",_);N.off("error",S);B=O=!0;H[r].loaded=!0;videojs.isAd=!0;J.addClass(K,"vjs-ad-playing");V=!0;f(H[r],!0);i=!0;break}}if(!0!==i){for(var e=!0,r=0;r<H.length;r++)!0!==H[r].loaded&&(e=!1);N.off("timeupdate",_);N.off("error",S);a(e);q(N);ie=null}}}var m,g,b=!1;function y(e){e=N.currentTime();if((t=N.duration())>0){var t=((t=t.toFixed(0))/4).toFixed(0);if(e>t&&!0!==m){k("fistQuartile");m=!0}if(e>2*t&&!0!==g){k("midpoint");g=!0}if(e>3*t&&!0!==b){k("thirdQuartile");b=!0}if(U>-1){t=Math.ceil(U-e);J.removeClass(ee,"vjs-hidden");if(t>0){var e=oe("Skip Ad in %%TIME%%"),i=(ee.innerHTML="",re("p","vast-skip-button-text"));ee.appendChild(i);i.innerHTML=e.replace("%%TIME%%",t)}else{ee.className="vast-skip-button enabled";ee.innerHTML=oe("Skip Ad")+'<span class="vjs-vast-skip-icon"><svg viewBox="0 0 32 32"><path d="M7 24l12.75-9-12.75-9v18zM22 6v18h3v-18h-3z"></path></svg></span>'}}}}function j(){if(videojs.adinfo)if(!(i=N.el_.querySelector(".vjs-ainfo"))){let e=re("style"),t=".vjs-ad-playing .vjs-ainfo{position: absolute;top:10px;left:10px;display:inline-block;opacity:.8;cursor:pointer;height:18px;}";t=(t+=".vjs-ad-playing .vjs-ainfo .vjs-ico-block {height:18px;width:18px;display:inline-block;float:left;filter:drop-shadow(1px 1px 1px #000);}")+".vjs-ad-playing .vjs-ainfo .vjs-label {line-height:18px;float:left;height:18px;transition:all .25s ease;filter:drop-shadow(1px 1px 1px #000);margin-left:5px;max-width:0;font-size:13px;overflow:hidden;display:inline-block;margin-right:5px;}"+".vjs-ad-playing .vjs-ainfo:hover .vjs-label {max-width:200px}.vjs-ad-playing .vjs-ainfo-right {right:10px;left:auto;top:auto;bottom:15px}.vjs-ad-playing .vjs-ainfo-right .vjs-ico-block {float:right}";e.innerHTML=t;N.el_.appendChild(e);var i=re("div","vjs-ainfo"),r=re("div","vjs-ico-block"),o=(r.innerHTML='<svg fill="none" viewBox="0 0 24 24"><path fill-rule="evenodd" fill="white" d="M2 12C2 6.48 6.48 2 12 2C17.52 2 22 6.48 22 12C22 17.52 17.52 22 12 22C6.48 22 2 17.52 2 12ZM13 16V18H11V16H13ZM12 20C7.59 20 4 16.41 4 12C4 7.59 7.59 4 12 4C16.41 4 20 7.59 20 12C20 16.41 16.41 20 12 20ZM8 10C8 7.79 9.79 6 12 6C14.21 6 16 7.79 16 10C16 11.28 15.21 11.97 14.44 12.64C13.71 13.28 13 13.90 13 15H11C11 13.17 11.94 12.45 12.77 11.82C13.42 11.32 14 10.87 14 10C14 8.9 13.1 8 12 8C10.9 8 10 8.9 10 10H8Z"></path></svg>',re("div","vjs-label"));o.innerHTML=N.localize("Information");i.appendChild(r);i.appendChild(o);N.el_.appendChild(i);N.$(".vjs-tech").hasAttribute("outstreamvisit")&&i.classList.add("vjs-ainfo-right");i.onclick=e=>{N.pause();window.open(videojs.adinfo,"_blank")}}}function k(e,t){if(P){var i=new Image,e="?event="+e;R.id&&(e=e+"&id="+R.id);i.src=P+e}}function x(e){var t=N.el_.querySelectorAll(e);if(t)for(var i=0;i<t.length;i++)t[i].parentNode.removeChild(t[i])}function T(){x(".vast-skip-button");(ee=re("div","vast-skip-button vjs-hidden")).id="adSkipButton";ee.ariaDisabled="false";ee.tabIndex="0";L=re("p","vast-skip-button-text");ee.appendChild(L);N.el_.appendChild(ee);ee.onclick=function(e){t(e)};function t(e){e.stopPropagation();if((" "+ee.className+" ").indexOf(" enabled ")>=0){N.trigger("vroll",{id:R.id,action:"skipped"});k("skipped");("postroll"===R.method?l:h)()}}}function C(){}function S(){N.trigger("vroll",{id:R.id,action:"error"});k("error");var e=N.el_.querySelector(".vjs-black-poster");e&&e.parentNode.remove(e);!0!==z&&($=!0);("postroll"===R.method?l:h)();V=!1}function _(){p()||y(N.currentTime(),N.duration())}function A(){if(!$){B=!0;setTimeout(function(){try{I(N)}catch(e){}},100);if(!le()&&!R.cancelled){N.$(".vjs-tech").hasAttribute("outstreamvisit")&&N.el_.classList.add("vjs-set-visit");j();let e=N.muted(),t=(N.muted(e),K.querySelector(".vjs-black-poster"));t&&t.parentNode.removeChild(t);N.currentTime(0);N.one("ended",C);N.on("timeupdate",_);R.offset>0&&J.addClass(w,"vjs-hidden");(U=parseInt(R.skip,10))>-1&&T();J.addClass(K,"vjs-ad-playing");J.addClass(w,"vjs-hidden");var r=N.el_.querySelector(".vjs-black-poster");if(r){N.el_.removeChild(r);W=null}D&&N.volume(D);let i=N.el_.querySelector(".vjs-poster");i&&i.removeAttribute("style");E.className="vast-blocker";if(R.href){if(N.$(".vjs-tech").hasAttribute("outstreamvisit")){E.className="vast-blocker vjs-visit-blocker";E.innerText=N.localize("VISIT")}E.removeAttribute("style");E.href=R.href;N.adhref=R.href;R.target?E.target=R.target:E.target="_blank"}else E.style.pointerEvents="none";if(V){N.trigger("vroll",{id:R.id,action:"start"});k("adstart");V=!1}}}}}}}}})}var vroll=function(e){this.ready(function(){vrollInit(this,e)})};"undefined"!==typeof window&&videojs.registerPlugin("vroll",vroll);module.exports=vroll;
